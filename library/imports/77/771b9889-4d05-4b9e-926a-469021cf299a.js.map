{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Loading.js"],"names":["Remote","require","cc","Class","extends","Component","properties","onLoad","start","console","log","wxLogin","window","wx","onShareAppMessage","title","imageUrl","showShareMenu","withShareTicket","onShow","curTime","Date","getTime","launch","getLaunchOptionsSync","queryData","query","diyData","diy","onShareClick","closeTime","shareAppMessage","onCameraClick","self","canvas","game","width","winSize","height","toTempFilePath","x","y","destWidth","destHeight","success","res","saveImage","tempFilePath","filePath","sys","platform","WECHAT_GAME","imgSrc","getSetting","authSetting","authorize","scope","saveImageToPhotosAlbum","data","showTipsUI","fail","err","showModal","content","confirm","openSetting","cb","undefined","login","code","errMsg","exportJson","sysInfo","getSystemInfoSync","screenWidth","screenHeight","getUserInfo","userInfo","headUrl","avatarUrl","button","createUserInfoButton","type","text","style","left","top","backgroundColor","color","fontSize","textAlign","lineHeight","onTap","destroy"],"mappings":"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","file":"Loading.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar Remote = require(\"Remote\")\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        \r\n    },\r\n\r\n    start () {\r\n        console.log(\"loading start\")\r\n\r\n        this.wxLogin(()=>{\r\n\r\n           \r\n        })\r\n\r\n        window.wx.onShareAppMessage(() => {\r\n            console.log(\"右上角转发\")\r\n            return {\r\n              title: '转发标题',\r\n              imageUrl: '' // 图片 URL\r\n            }\r\n          })\r\n\r\n        window.wx.showShareMenu({\r\n            withShareTicket: true\r\n        })\r\n\r\n        window.wx.onShow(function () {\r\n            //分享后返回\r\n            let curTime = new Date().getTime();\r\n            console.log(\"onShow   \" + curTime)\r\n        })\r\n\r\n        var launch = window.wx.getLaunchOptionsSync();\r\n            var queryData = launch.query;\r\n            var diyData = queryData.diy;\r\n            if (diyData != null && diyData != \"\") {\r\n                console.log(\"微信透传参数：\" + diyData);\r\n            }\r\n            else {\r\n                console.log(\"微信平台无透传参数\");\r\n            }\r\n    },\r\n\r\n    onShareClick: function(){\r\n\r\n        let closeTime = new Date().getTime();\r\n        console.log(\"onShareClick   \" + closeTime)\r\n        window.wx.shareAppMessage({\r\n            title: \"你是一个，一个一个一个\",\r\n            imageUrl: \"Resources/CP0541007714.png\", //可以是网络图片Url也可以本地路径\r\n            query: \"diy=\" + \"{\\\"a\\\" = \\\"helloworld\\\"}\",\r\n        })\r\n    },\r\n\r\n    onCameraClick: function(){\r\n        var self = this\r\n        var canvas = cc.game.canvas;\r\n        var width  = cc.winSize.width;\r\n        var height  = cc.winSize.height;\r\n        canvas.toTempFilePath({\r\n            x: 0,\r\n            y: 0,\r\n            width: width,\r\n            height: height,\r\n            destWidth: width,\r\n            destHeight: height,\r\n            success (res) {\r\n                //.可以保存该截屏图片\r\n                console.log(res)\r\n            //     wx.previewImage({\r\n            //         current: res.tempFilePath,\r\n            //         urls: [res.tempFilePath]\r\n            //    })\r\n                // wx.shareAppMessage({\r\n                //     imageUrl: res.tempFilePath\r\n                // })\r\n                self.saveImage(res.tempFilePath)\r\n            }\r\n        })\r\n    },\r\n\r\n    saveImage: function(filePath){ //保存图片到本地\r\n        if(!(cc.sys.platform === cc.sys.WECHAT_GAME)) return;\r\n        var self = this;\r\n        var imgSrc = filePath\r\n        wx.getSetting({\r\n            success(res) {\r\n                if (!res.authSetting['scope.writePhotosAlbum']) { //未授权\r\n                    wx.authorize({\r\n                        scope:'scope.writePhotosAlbum',\r\n                        success() {\r\n                            console.log('授权成功')\r\n                            wx.saveImageToPhotosAlbum({\r\n                                    filePath: imgSrc,\r\n                                    success:function (data) {\r\n                                        console.log(data);\r\n                                        self.showTipsUI(\"题目图片保存成功\");\r\n                                    },\r\n                                    fail:function (err) {\r\n                                        console.log(err);\r\n                                    }\r\n                            });\r\n                        },\r\n                        fail() {\r\n                            console.log(\"授权失败\");\r\n                            wx.showModal({\r\n                                title: '提示',\r\n                                content: '点击确定，保存图片到相册。',\r\n                                success:function(res){\r\n                                    if (res.confirm){\r\n                                        wx.openSetting({\r\n                                            success(res){\r\n                                                console.log(\"重新获得保存图片授权状态\");\r\n                                                if (res.authSetting[\"scope.writePhotosAlbum\"]){ //如果用户重新同意了授权登录\r\n                                                        wx.saveImageToPhotosAlbum({\r\n                                                            filePath: imgSrc,\r\n                                                            success:function (data) {\r\n                                                                console.log(data);\r\n//                                                                 self.showTipsUI(\"题目图片保存成功\");\r\n                                                            },\r\n                                                            fail:function (err) {\r\n                                                                console.log(err);\r\n                                                            }\r\n                                                        });\r\n                                                }\r\n                                            },\r\n                                            fail(){\r\n                                                console.log(\"重新获得保存图片授权状态失败\");\r\n                                            }\r\n                                        }) \r\n                                    }\r\n                                }\r\n                            })\r\n                        }\r\n                    });\r\n                }else{ //已授权\r\n                       wx.saveImageToPhotosAlbum({\r\n                            filePath: imgSrc,\r\n                            success:function (data) {\r\n                                console.log(data);\r\n//                                 self.showTipsUI(\"题目图片保存成功\");\r\n                            },\r\n                            fail:function (err) {\r\n                                console.log(err);\r\n                            }\r\n                       });\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    wxLogin: function(cb){\r\n\r\n        if(window.wx == undefined){\r\n            if(cb){\r\n                cb()\r\n            }\r\n            return\r\n        }\r\n\r\n        // window.wx.exitMiniProgram(()=>{\r\n\r\n        // },()=>{\r\n\r\n        // },()=>{\r\n        //     console.log(\"logout complete\")\r\n        // })\r\n\r\n        window.wx.login({\r\n            success (res) {\r\n              if (res.code) {\r\n                console.log('登录成功！' + res.code )\r\n                // //发起网络请求\r\n                // wx.request({\r\n                //   url: 'https://test.com/onLogin',\r\n                //   data: {\r\n                //     code: res.code\r\n                //   }\r\n                // })\r\n                // Remote.login(res.code, \"asas\", ()=>{\r\n                    \r\n                // })\r\n              } else {\r\n                console.log('登录失败！' + res.errMsg)\r\n              }\r\n            }\r\n          })\r\n\r\n\r\n        let exportJson = {};\r\n        let sysInfo = window.wx.getSystemInfoSync();\r\n        //获取微信界面大小\r\n        let width = sysInfo.screenWidth;\r\n        let height = sysInfo.screenHeight;\r\n        window.wx.getSetting({\r\n            success (res) {\r\n                console.log(res.authSetting);\r\n                if (res.authSetting[\"scope.userInfo\"]) {\r\n                    console.log(\"用户已授权\");\r\n                    window.wx.getUserInfo({\r\n                        success(res){\r\n                            console.log(res);\r\n                            exportJson.userInfo = res.userInfo;\r\n                            //此时可进行登录操作\r\n                            var headUrl = res.userInfo.avatarUrl\r\n                            if(cb){\r\n                                cb()\r\n                            }\r\n                        }\r\n                    });\r\n                }else {\r\n                    console.log(\"用户未授权\");\r\n                    let button = window.wx.createUserInfoButton({\r\n                        type: 'text',\r\n                        text: '',\r\n                        style: {\r\n                            left: 0,\r\n                            top: 0,\r\n                            width: width,\r\n                            height: height,\r\n                            backgroundColor: '#00000000',//最后两位为透明度\r\n                            color: '#ffffff',\r\n                            fontSize: 20,\r\n                            textAlign: \"center\",\r\n                            lineHeight: height,\r\n                        }\r\n                    });\r\n                    button.onTap((res) => {\r\n                        if (res.userInfo) {\r\n                            console.log(\"用户授权:\", res);\r\n                            exportJson.userInfo = res.userInfo;\r\n                            var headUrl = res.userInfo.avatarUrl\r\n                           \r\n                            //此时可进行登录操作\r\n                            button.destroy();\r\n                        }else {\r\n                            console.log(\"用户拒绝授权:\", res);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n         })\r\n    }\r\n\r\n    // update (dt) {},\r\n});\r\n"]}